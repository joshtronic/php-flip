<?php
namespace joshtronic;

class Flip
{
    // Taken from http://www.fileformat.info/convert/text/upside-down-map.htm
    private $map = array(
        '!' => 'Â¡',
        '"' => 'â€ž',
        '&' => 'â…‹',
        "'" => ',',
        '(' => ')',
        '.' => 'Ë™',
        '3' => 'Æ',
        '4' => 'á”­',
        '6' => '9',
        '7' => 'â±¢',
        ';' => 'Ø›',
        '<' => '>',
        '?' => 'Â¿',
        'A' => 'âˆ€',
        'B' => 'ð’',
        'C' => 'â†ƒ',
        'D' => 'â—–',
        'E' => 'ÆŽ',
        'F' => 'â„²',
        'G' => 'â…',
        'J' => 'Å¿',
        'K' => 'â‹Š',
        'L' => 'â…‚',
        'M' => 'W',
        'N' => 'á´Ž',
        'P' => 'Ô€',
        'Q' => 'ÎŒ',
        'R' => 'á´š',
        'T' => 'âŠ¥',
        'U' => 'âˆ©',
        'V' => 'á´§',
        'Y' => 'â…„',
        '[' => ']',
        '_' => 'â€¾',
        'a' => 'É',
        'b' => 'q',
        'c' => 'É”',
        'd' => 'p',
        'e' => 'Ç',
        'f' => 'ÉŸ',
        'g' => 'Æƒ',
        'h' => 'É¥',
        'i' => 'Ä±',
        'j' => 'É¾',
        'k' => 'Êž',
        'l' => 'Êƒ',
        'm' => 'É¯',
        'n' => 'u',
        'r' => 'É¹',
        't' => 'Ê‡',
        'v' => 'ÊŒ',
        'w' => 'Ê',
        'y' => 'ÊŽ',
        '{' => '}',
        'â€¿' => 'â€',
        'â…' => 'â†',
        'âˆ´' => 'âˆµ',
        'Â¡' => '!',
        'â€ž' => '"',
        'â…‹' => '&',
        ',' => '\'',
        ')' => '(',
        'Ë™' => '.',
        'Æ' => '3',
        'á”­' => '4',
        '9' => '6',
        'â±¢' => '7',
        'Ø›' => ';',
        '>' => '<',
        'Â¿' => '?',
        'âˆ€' => 'A',
        'ð’' => 'B',
        'â†ƒ' => 'C',
        'â—–' => 'D',
        'ÆŽ' => 'E',
        'â„²' => 'F',
        'â…' => 'G',
        'Å¿' => 'J',
        'â‹Š' => 'K',
        'â…‚' => 'L',
        'W' => 'M',
        'á´Ž' => 'N',
        'Ô€' => 'P',
        'ÎŒ' => 'Q',
        'á´š' => 'R',
        'âŠ¥' => 'T',
        'âˆ©' => 'U',
        'á´§' => 'V',
        'â…„' => 'Y',
        ']' => '[',
        'â€¾' => '_',
        'É' => 'a',
        'q' => 'b',
        'É”' => 'c',
        'p' => 'd',
        'Ç' => 'e',
        'ÉŸ' => 'f',
        'Æƒ' => 'g',
        'É¥' => 'h',
        'Ä±' => 'i',
        'É¾' => 'j',
        'Êž' => 'k',
        'Êƒ' => 'l',
        'É¯' => 'm',
        'u' => 'n',
        'É¹' => 'r',
        'Ê‡' => 't',
        'ÊŒ' => 'v',
        'Ê' => 'w',
        'ÊŽ' => 'y',
        '}' => '{',
        'â€' => 'â€¿',
        'â†' => 'â…',
        'âˆµ' => 'âˆ´',
    );

    private $flipped_guy = array(
        '/', '(', ' ', '.', ' ', '0', ' ', '.', '\\', '\\', ')'
    );

    public function __construct()
    {
        // Maps inverted characters
        foreach ($this->map as $a => $b) {
            $this->map[$b] = $a;
        }
    }

    public function flip($string)
    {
        if (!is_string($string)) {
            return null;
        }

        $length  = strlen($string) - 1;
        $results = array();

        for ($i = $length; $i >= 0; $i--) {
            if ($i >= 6 && substr($string, $i - 7, $i) == '(â•¯Â°â–¡Â°ï¼‰â•¯') {
                $results = array_merge($results, $this->flipped_guy);
                $i -= 7;
            } else {
                $chr       = $string[$i];
                $results[] = isset($this->map[$chr]) ? $this->map[$chr] : $chr;
            }
        }

        return implode('', $results);
    }
}

